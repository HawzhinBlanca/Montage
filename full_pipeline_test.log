/Users/hawzhin/.pyenv/versions/3.11.5/lib/python3.11/site-packages/transformers/utils/hub.py:111: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
2025-07-21 01:08:41,900 | INFO | src.config | ✅ OpenAI API key configured
2025-07-21 01:08:41,900 | INFO | src.config | ✅ Anthropic API key configured
2025-07-21 01:08:41,901 | INFO | src.config | ✅ Deepgram API key configured
2025-07-21 01:08:41,901 | INFO | src.config | ✅ Config loaded - MAX_COST_USD: $5.0
✅ DaVinci Resolve API available
✅ Connected to DaVinci Resolve
       Video Information        
┏━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┓
┃ Property    ┃ Value          ┃
┡━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━┩
│ File        │ test_video.mp4 │
│ Duration    │ 2595.7 seconds │
│ Size        │ 83.4 MB        │
│ Resolution  │ 640x360        │
│ FPS         │ 24.0           │
│ Video Codec │ h264           │
│ Audio Codec │ aac            │
└─────────────┴────────────────┘

🚀 Starting MCP server...
Bottle v0.13.4 server starting up (using WSGIRefServer())...
Listening on http://localhost:7801/
Hit Ctrl-C to quit.

127.0.0.1 - - [21/Jul/2025 01:08:44] "GET /health HTTP/1.1" 200 20
🚀 Starting MCP bridge server on localhost:7801
   DaVinci Resolve: Available
   Endpoints: /buildTimeline, /renderProxy, /status, /health
✅ MCP server started successfully

🎬 Processing video in SMART mode
   Video: test_video.mp4
📁 Output directory: /Users/hawzhin/Montage/output
2025-07-21 01:08:47,033 | INFO | faster_whisper | Processing audio with duration 43:15.712
2025-07-21 01:08:48,255 | INFO | faster_whisper | Detected language 'en' with probability 0.97
2025-07-21 01:11:35,723 | INFO | httpx | HTTP Request: POST https://api.deepgram.com/v1/listen?diarize=true&language=en-US&model=nova-2&punctuate=true&smart_format=true&utterances=true "HTTP/1.1 200 OK"
2025-07-21 01:11:41,010 | INFO | httpx | HTTP Request: POST https://api.deepgram.com/v1/listen?diarize=true&language=en-US&model=nova-2&punctuate=true&smart_format=true&utterances=true "HTTP/1.1 200 OK"
2025-07-21 01:11:47,295 | INFO | httpx | HTTP Request: POST https://api.deepgram.com/v1/listen?diarize=true&language=en-US&model=nova-2&punctuate=true&smart_format=true&utterances=true "HTTP/1.1 200 OK"
2025-07-21 01:11:52,930 | INFO | httpx | HTTP Request: POST https://api.deepgram.com/v1/listen?diarize=true&language=en-US&model=nova-2&punctuate=true&smart_format=true&utterances=true "HTTP/1.1 200 OK"
2025-07-21 01:12:00,169 | INFO | httpx | HTTP Request: POST https://api.deepgram.com/v1/listen?diarize=true&language=en-US&model=nova-2&punctuate=true&smart_format=true&utterances=true "HTTP/1.1 200 OK"
2025-07-21 01:12:05,985 | INFO | httpx | HTTP Request: POST https://api.deepgram.com/v1/listen?diarize=true&language=en-US&model=nova-2&punctuate=true&smart_format=true&utterances=true "HTTP/1.1 200 OK"
2025-07-21 01:12:39,109 | INFO | httpx | HTTP Request: POST https://api.deepgram.com/v1/listen?diarize=true&language=en-US&model=nova-2&punctuate=true&smart_format=true&utterances=true "HTTP/1.1 200 OK"
2025-07-21 01:12:44,664 | INFO | httpx | HTTP Request: POST https://api.deepgram.com/v1/listen?diarize=true&language=en-US&model=nova-2&punctuate=true&smart_format=true&utterances=true "HTTP/1.1 200 OK"
2025-07-21 01:12:48,983 | INFO | httpx | HTTP Request: POST https://api.deepgram.com/v1/listen?diarize=true&language=en-US&model=nova-2&punctuate=true&smart_format=true&utterances=true "HTTP/1.1 200 OK"
2025-07-21 01:12:49,060 | INFO | src.core.cost | API call to deepgram.nova-2: $0.0003 (total: $0.0003)
🎬 Analyzing video: /Users/hawzhin/Montage/test_video.mp4
✅ Faster-whisper transcribed 6831 words
🔄 Large file (2595.7s) - chunking for Deepgram
📋 Processing 9 chunks of 300s each
🔄 Chunk 1/9: 0.0s - 300.0s
✅ Chunk 1 completed: 710 total words
🔄 Chunk 2/9: 300.0s - 600.0s
✅ Chunk 2 completed: 1554 total words
🔄 Chunk 3/9: 600.0s - 900.0s
✅ Chunk 3 completed: 2356 total words
🔄 Chunk 4/9: 900.0s - 1200.0s
✅ Chunk 4 completed: 3196 total words
🔄 Chunk 5/9: 1200.0s - 1500.0s
✅ Chunk 5 completed: 4048 total words
🔄 Chunk 6/9: 1500.0s - 1800.0s
✅ Chunk 6 completed: 4863 total words
🔄 Chunk 7/9: 1800.0s - 2100.0s
✅ Chunk 7 completed: 5729 total words
🔄 Chunk 8/9: 2100.0s - 2400.0s
✅ Chunk 8 completed: 6605 total words
🔄 Chunk 9/9: 2400.0s - 2595.7s
✅ Chunk 9 completed: 7108 total words
✅ Deepgram chunked transcription completed: 7108 words
🔧 Removed 218 duplicate words
✅ ROVER merged 6831 + 6992 → 6961 words
🎤 Using Deepgram's speaker diarization
✅ Deepgram diarization found 1197 speaker turns
✅ Video analysis complete: 6961 words, 1197 speaker turns
📝 Transcript: 6961 words, 1197 speaker turns
⠏ ✅ Video analysis complete
2025-07-21 01:13:05,914 | INFO | src.core.highlight_selector | 🎯 Starting REAL highlight analysis (no fake AI)
2025-07-21 01:13:05,914 | INFO | src.core.highlight_selector | 📊 Performing real local content scoring...
2025-07-21 01:13:05,914 | INFO | src.core.highlight_selector | ⚙️ Running real local rule-based scoring...
2025-07-21 01:13:05,919 | INFO | src.core.highlight_selector | ✅ Real local scoring generated 8 highlights
2025-07-21 01:13:05,919 | INFO | src.core.highlight_selector | ✅ Local scoring found 8 potential highlights
2025-07-21 01:13:05,919 | INFO | src.core.highlight_selector | 🧠 Enhancing with real Gemini AI analysis...
2025-07-21 01:13:10,585 | INFO | src.core.highlight_selector | ✅ Gemini story analysis complete: 3 narrative beats identified
2025-07-21 01:13:10,585 | INFO | src.core.cost | API call to gemini.2-5-flash: $0.00001 (total: $0.00031)
2025-07-21 01:13:10,585 | INFO | src.core.highlight_selector | ✅ Gemini generated 3 story-based highlights
2025-07-21 01:13:10,585 | INFO | src.core.highlight_selector | 🔗 Combined into 6 final highlights
🔧 Converted 6961 words to 1540 segments
⠇ ✅ Highlights selected
🎯 Selected 6 highlights (Cost: $0.000)
✅ Created subtitle file: /Users/hawzhin/Montage/output/subtitles/subtitle_1.srt (2 lines)
✅ Created subtitle file: /Users/hawzhin/Montage/output/subtitles/subtitle_2.srt (3 lines)
✅ Created subtitle file: /Users/hawzhin/Montage/output/subtitles/subtitle_3.srt (3 lines)
✅ Created subtitle file: /Users/hawzhin/Montage/output/subtitles/subtitle_4.srt (3 lines)
✅ Created subtitle file: /Users/hawzhin/Montage/output/subtitles/subtitle_5.srt (3 lines)
✅ Created subtitle file: /Users/hawzhin/Montage/output/subtitles/subtitle_6.srt (2 lines)
📄 Created 6 subtitle files
⠋ ✅ Subtitles created
✅ DaVinci timeline created
🎬 Starting DaVinci Resolve render: /Users/hawzhin/Montage/output/Montage_1753049590_timeline.mp4
...127.0.0.1 - - [21/Jul/2025 01:13:18] "POST /buildTimeline HTTP/1.1" 200 236

✅ DaVinci Resolve render complete
✅ Moved Montage_1753049590_timeline.mov to Montage_1753049590_timeline.mp4
🎬 Timeline created: davinci_resolve_rendered
⠹ ✅ Timeline built

✅ Pipeline Completed Successfully!

🎥 Output video created: 
/Users/hawzhin/Montage/output/Montage_1753049590_timeline.mp4
   Size: 66.65 MB

📊 Analysis Summary:
   • Words transcribed: 6961
   • Speaker turns: 1197
   • Transcript length: 39987 characters

🎯 Highlights Summary:
   • Mode: SMART
   • Clips selected: 6
   • Total cost: $0.000
                            Top Highlights                            
┏━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━┓
┃ Clip ┃ Title                                    ┃ Duration ┃ Score ┃
┡━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━┩
│ 1    │ well my question, i guess, is            │ 5.4s     │ 10.9  │
│ 2    │ and so i said said, alright              │ 9.3s     │ 11.1  │
│ 3    │ and really, the only true evidence       │ 9.5s     │ 11.1  │
│ 4    │ For example, there's one called sperm... │ 13.1s    │ 11.5  │
│ 5    │ and it's really quite an amazing         │ 10.2s    │ 11.2  │
└──────┴──────────────────────────────────────────┴──────────┴───────┘

🎬 Timeline Summary:
   • Method: davinci_resolve_rendered
   • Clips added: 6
   • Output: /Users/hawzhin/Montage/output/Montage_1753049590_timeline.mp4

💾 Full plan saved to: montage_plan_1753049598.json
